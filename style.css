  :root { --bg:#f8f9fa; --panel:#ffffff; --grid:#ffffff; --muted:#5f6368; --text:#202124; --accent:#1a73e8; --sel:#e8f0fe; --err:#fce8e6; --errBorder:#d93025; }
  *{box-sizing:border-box}
  .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,Segoe UI,Roboto,Arial,sans-serif}
  header{display:flex;gap:.5rem;align-items:center;padding:.5rem 1rem;border-bottom:1px solid #dadce0;background:var(--panel)}
  header h1{font-size:16px;margin:0 1rem 0 0;font-weight:500;letter-spacing:.2px;color:var(--text)}
  button, .btn-file, select, input[type="color"]{background:#f1f3f4;border:1px solid #dadce0;border-radius:4px;padding:.4rem .75rem;color:var(--text);cursor:pointer}
  button:hover,.btn-file:hover, select:hover, input[type="color"]:hover{background:#e8eaed}
  button[disabled]{opacity:.55;cursor:not-allowed}
  button[aria-pressed="true"]{background:var(--sel);box-shadow:inset 0 0 0 1px var(--accent)}
  .btn-file{position:relative;overflow:hidden;display:inline-flex;align-items:center;gap:.5rem}
  .btn-file input{position:absolute;inset:0;opacity:0;cursor:pointer}
  .toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-left:auto}
  #formulaBar{flex:1;background:#fff;border:1px solid #dadce0;border-radius:4px;padding:.4rem;color:var(--text)}
  .wrap{padding:12px}
  .sheet{background:var(--panel);border:1px solid #dadce0;border-radius:0;overflow:auto;max-height:70vh}
  table{border-collapse:separate;border-spacing:0;min-width:720px}
  thead th{position:sticky;top:0;background:#f8f9fa;z-index:3;color:#3c4043;font-weight:500}
  tbody th{position:sticky;left:0;background:#f8f9fa;z-index:2;color:#3c4043;font-weight:500}
  th, td{border-right:1px solid #dadce0;border-bottom:1px solid #dadce0;min-width:100px}
  thead th:first-child{left:0;z-index:4}
  th{padding:.4rem .5rem;text-align:center}
  td{padding:0}
  td .cell{padding:.45rem .5rem;outline:none;min-height:32px}
  td .cell:focus{background:var(--sel);box-shadow:inset 0 0 0 2px var(--accent);outline:none}
  td .cell.formula-cursor{outline:2px dotted var(--accent);outline-offset:-2px}
  tr:nth-child(even) td{background:var(--grid)}
  tr:nth-child(odd) td{background:var(--grid)}
  .cell.err{background:var(--err)!important;border:1px solid var(--errBorder)}
  .col-resizer{position:absolute;top:0;right:0;width:4px;height:100%;cursor:col-resize;user-select:none}
  .row-resizer{position:absolute;bottom:0;left:0;width:100%;height:4px;cursor:row-resize;user-select:none}
  .status{display:flex;gap:1rem;align-items:center;margin-top:10px;color:var(--muted);flex-wrap:wrap}
  .status code{background:#f1f3f4;border:1px solid #dadce0;border-radius:8px;padding:.25rem .5rem;color:#174ea6}
  .pill{border:1px solid #dadce0;border-radius:999px;padding:.2rem .5rem}
  .hint{opacity:.8}
  .danger{color:#d93025}
  .ok{color:#188038}
.sheetTabsBar{border-top:1px solid #dadce0;background:var(--panel);margin-top:4px}
.sheetTabs{display:flex;align-items:center;gap:2px;padding:4px;overflow-x:auto}
.sheetTab{display:flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:#e8eaed;border:1px solid transparent;border-radius:4px 4px 0 0;color:var(--muted);cursor:pointer}
.sheetTab.active{background:var(--panel);color:var(--text);border-color:#dadce0;border-bottom:1px solid var(--panel);box-shadow:0 -2px 0 0 var(--accent) inset}
.sheetTab .close{margin-left:.25rem;font-weight:600;cursor:pointer;opacity:0;transition:opacity .2s}
.sheetTab:hover .close{opacity:.6}
.sheetTab.add{padding:0;width:24px;height:24px;border-radius:50%;background:transparent;color:var(--muted);border:0}
.sheetTab.add:hover{background:#e8eaed}

.sheetTab:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .debug{margin-top:10px;background:#f1f3f4;border:1px solid #dadce0;border-radius:12px;padding:8px;max-height:20vh;overflow:auto}
  .debug h3{margin:0 0 6px 0;font-size:12px;color:#202124}
  .debug pre{margin:0;font-size:12px;white-space:pre-wrap;word-break:break-word;color:#202124}

  .debug .row{opacity:.9}
  @media (max-width:900px){th, td{min-width:80px} header{gap:.4rem} header h1{display:none}}

/* Medium mobile devices - 600px and below */
@media (max-width:600px){
  body{font-size:13px}
  header{padding:.5rem;flex-direction:column;align-items:stretch}
  header h1{font-size:14px;margin:0}
  
  /* Show hamburger menu */
  .hamburger{display:flex}
  .header-nav{display:none;flex-direction:column;gap:.5rem;margin-top:.5rem;padding-top:.5rem;border-top:1px solid #dadce0}
  .header-nav.open{display:flex}
  
  header .group{gap:.3rem;justify-content:center;flex-wrap:wrap;margin:.25rem 0}
  button, .btn-file, select, input[type="color"]{padding:.4rem .6rem;font-size:13px;border-radius:8px}
  #formulaBar{padding:.4rem;font-size:13px;width:100%;margin:.25rem 0}
  .toolbar{gap:.3rem;justify-content:center;flex-wrap:wrap;margin:.25rem 0}
  .wrap{padding:8px}
  .sheet{border-radius:10px;max-height:60vh}
  th, td{min-width:70px;font-size:13px}
  th{padding:.3rem .4rem}
  td .cell{padding:.35rem .4rem;min-height:28px;font-size:13px}
  .status{gap:.6rem;font-size:12px;margin-top:8px}
  .status .pill{padding:.15rem .4rem;font-size:12px}
  .sheetTabs{gap:.2rem;justify-content:center;flex-wrap:wrap}
  .sheetTab{padding:.2rem .5rem;font-size:12px;border-radius:8px 8px 0 0}
  .debug{padding:6px;max-height:15vh}
  .debug h3{font-size:11px}
  .debug pre{font-size:11px}
  .menu .menu-items{min-width:140px;padding:.25rem}
  .menu .menu-items button{padding:.4rem .5rem;font-size:13px}
}

/* Small mobile devices - 400px and below */
@media (max-width:400px){
  body{font-size:12px}
  header{padding:.4rem;flex-direction:column;align-items:stretch}
  header h1{font-size:13px;margin:0}
  
  /* Hamburger menu styles for smallest screens */
  .hamburger{display:flex;width:26px;height:26px}
  .hamburger span{height:2px;margin:2px 0}
  .header-nav{gap:.4rem;margin-top:.4rem;padding-top:.4rem}
  
  header .group{justify-content:center;flex-wrap:wrap;margin:.2rem 0}
  button, .btn-file, select, input[type="color"]{padding:.3rem .5rem;font-size:12px;border-radius:6px}
  #formulaBar{padding:.3rem;font-size:12px;width:100%;margin:.2rem 0}
  .toolbar{gap:.2rem;justify-content:center;flex-wrap:wrap;margin:.2rem 0}
  .wrap{padding:4px}
  .sheet{border-radius:8px;max-height:50vh}
  table{min-width:300px}
  th, td{min-width:60px;font-size:12px}
  th{padding:.25rem .3rem}
  td .cell{padding:.3rem .35rem;min-height:24px;font-size:12px}
  .status{flex-direction:column;align-items:flex-start;gap:.4rem;font-size:11px;margin-top:6px}
  .status .pill{padding:.1rem .3rem;font-size:11px}
  .sheetTabs{flex-wrap:wrap;gap:.15rem;justify-content:center}
  .sheetTab{padding:.15rem .4rem;font-size:11px;border-radius:6px 6px 0 0}
  .debug{padding:4px;max-height:12vh}
  .debug h3{font-size:10px}
  .debug pre{font-size:10px}
  .menu .menu-items{min-width:120px;padding:.2rem;font-size:12px}
  .menu .menu-items button{padding:.3rem .4rem;font-size:12px}
  .col-resizer, .row-resizer{display:none} /* Hide resizers on very small screens */
}


/* --- Hamburger menu and header navigation --- */
.header-main{display:flex;justify-content:space-between;align-items:center;width:100%}
.hamburger{display:none;flex-direction:column;justify-content:center;width:30px;height:30px;background:transparent;border:0;cursor:pointer;padding:0}
.hamburger span{display:block;height:3px;width:100%;background:var(--text);margin:3px 0;transition:all 0.3s ease;border-radius:2px}
.hamburger.active span:nth-child(1){transform:rotate(45deg) translate(6px, 6px)}
.hamburger.active span:nth-child(2){opacity:0}
.hamburger.active span:nth-child(3){transform:rotate(-45deg) translate(6px, -6px)}

.header-nav{display:flex;gap:.5rem;align-items:center;flex:1}
.header-nav.open{display:flex}

/* --- Toolbar grouping and dropdown menus --- */
header .group{display:inline-flex;gap:.5rem;align-items:center}
.toolbar{display:flex;flex-wrap:wrap;gap:.5rem;margin-left:auto;align-items:center}
.menu{position:relative;display:inline-block}
.menu .menu-trigger{position:relative;padding-right:1.6rem}
.menu .menu-items{
  position:absolute;top:calc(100% + 6px);left:0;
  background:#fff;border:1px solid #dadce0;border-radius:8px;
  min-width:180px;padding:.35rem;display:none;z-index:50;
  box-shadow:0 8px 24px rgba(60,64,67,.15)
}
.menu .menu-items.right{right:0;left:auto}
.menu.open .menu-items{display:block}
/* pointer-friendly fallback */
@media(hover:hover){.menu:hover .menu-items{display:block}}
.menu .menu-items button{
  display:block;width:100%;text-align:left;
  background:transparent;border:0;border-radius:4px;
  padding:.5rem .6rem;color:var(--text)
}
.menu .menu-items button:hover{background:var(--sel)}

/* --- Active header highlighting and hover feedback --- */
thead th.active, tbody th.active{
  background: var(--sel);
  color: var(--text);
  box-shadow: inset 0 -2px 0 0 var(--accent), inset 2px 0 0 0 var(--accent);
}
thead th:hover, tbody th:hover{ filter: brightness(1.05); }
td .cell:hover{ background: rgba(94,160,255,.08); }
